# üìä Eventos de Herramientas Financieras ‚Üí n8n

## ‚úÖ Integraci√≥n Completada

Todas las funciones de **Herramientas Financieras** ahora env√≠an eventos a tu webhook de n8n:

```
https://userfox.app.n8n.cloud/webhook-test/finanzas-webhook
```

---

## üéØ Eventos Implementados

### 1Ô∏è‚É£ **Rastreador de Suscripciones**

**Cu√°ndo se dispara:** Usuario toca "Notificador de Suscripciones" üîî

**Payload enviado a n8n:**
```json
{
  "action": "subscription_tracker_accessed",
  "userId": "123",
  "timestamp": "1730000000000",
  "data": {
    "event_description": "Usuario accedi√≥ al rastreador de suscripciones",
    "timestamp": "1730000000000"
  }
}
```

**Uso en n8n:**
- Registrar uso de la funci√≥n
- Generar recordatorios de suscripciones
- An√°lisis de suscripciones m√°s consultadas

---

### 2Ô∏è‚É£ **Clasificador de Gastos**

**Cu√°ndo se dispara:** Usuario toca "Clasificador Autom√°tico de Gastos" üí∞

**Payload enviado a n8n:**
```json
{
  "action": "expense_classifier_accessed",
  "userId": "123",
  "timestamp": "1730000000000",
  "data": {
    "event_description": "Usuario accedi√≥ al clasificador de gastos",
    "timestamp": "1730000000000"
  }
}
```

**Uso en n8n:**
- Activar clasificaci√≥n autom√°tica de emails
- Sincronizar con servicios de categorizaci√≥n
- Generar reportes de gastos

---

### 3Ô∏è‚É£ **Cazador de Ofertas**

**Cu√°ndo se dispara:** Usuario toca "Cazador de Ofertas" üéØ

**Payload enviado a n8n:**
```json
{
  "action": "deal_hunter_accessed",
  "userId": "123",
  "timestamp": "1730000000000",
  "data": {
    "event_description": "Usuario accedi√≥ al cazador de ofertas",
    "timestamp": "1730000000000"
  }
}
```

**Uso en n8n:**
- Buscar ofertas en tiempo real
- Notificar sobre descuentos
- Comparar precios en diferentes tiendas

---

### 4Ô∏è‚É£ **Asistente por Voz**

#### 4A. Acceso al Asistente

**Cu√°ndo se dispara:** Usuario toca "Asistente por Voz" üé§

**Payload enviado a n8n:**
```json
{
  "action": "voice_assistant_accessed",
  "userId": "123",
  "timestamp": "1730000000000",
  "data": {
    "event_description": "Usuario accedi√≥ al asistente por voz",
    "timestamp": "1730000000000"
  }
}
```

#### 4B. Gasto Agregado por Voz

**Cu√°ndo se dispara:** Usuario confirma un gasto usando voz

**Payload enviado a n8n:**
```json
{
  "action": "voice_expense_added",
  "userId": "123",
  "timestamp": "1730000000000",
  "data": {
    "amount": "150.50",
    "merchant": "Super Mercado",
    "category": "Alimentaci√≥n",
    "input_method": "voice"
  }
}
```

**Uso en n8n:**
- Guardar gasto en base de datos
- Actualizar presupuesto autom√°ticamente
- Enviar confirmaci√≥n por email/SMS
- Analizar patrones de gasto
- Generar alertas si excede presupuesto

#### 4C. Cancelaci√≥n de Entrada por Voz

**Cu√°ndo se dispara:** Usuario cancela la entrada de voz

**Payload enviado a n8n:**
```json
{
  "action": "voice_input_cancelled",
  "userId": "123",
  "timestamp": "1730000000000",
  "data": {
    "event_description": "Usuario cancel√≥ la entrada de voz",
    "timestamp": "1730000000000"
  }
}
```

**Uso en n8n:**
- Analizar tasa de cancelaci√≥n
- Mejorar UX del asistente por voz

---

### 5Ô∏è‚É£ **Gamificaci√≥n y Retos**

**Cu√°ndo se dispara:** Usuario toca "Gamificaci√≥n y Retos" üèÜ

**Payload enviado a n8n:**
```json
{
  "action": "gamification_accessed",
  "userId": "123",
  "timestamp": "1730000000000",
  "data": {
    "event_description": "Usuario accedi√≥ a gamificaci√≥n y retos",
    "timestamp": "1730000000000"
  }
}
```

**Uso en n8n:**
- Actualizar progreso de retos
- Desbloquear logros
- Enviar notificaciones de nuevos retos
- Generar tabla de clasificaci√≥n

---

## üìà Resumen de Eventos

| Evento | Action | Tipo de Datos |
|--------|--------|---------------|
| Suscripciones | `subscription_tracker_accessed` | Evento simple |
| Clasificador | `expense_classifier_accessed` | Evento simple |
| Ofertas | `deal_hunter_accessed` | Evento simple |
| Voz - Acceso | `voice_assistant_accessed` | Evento simple |
| Voz - Gasto | `voice_expense_added` | Datos estructurados |
| Voz - Cancelar | `voice_input_cancelled` | Evento simple |
| Gamificaci√≥n | `gamification_accessed` | Evento simple |

**Total:** 7 eventos diferentes

---

## üé® Flujo de Usuario

```
Usuario en MainActivity
    ‚îÇ
    ‚îî‚îÄ‚îÄ‚ñ∫ Toca bot√≥n üõ†Ô∏è "Herramientas Financieras"
         ‚îÇ
         ‚îî‚îÄ‚îÄ‚ñ∫ Se env√≠a evento: "financial_tools_accessed"
              ‚îÇ
              ‚îî‚îÄ‚îÄ‚ñ∫ Abre FinancialToolsActivity
                   ‚îÇ
                   ‚îú‚îÄ‚îÄ‚ñ∫ Toca "Suscripciones" ‚Üí evento: subscription_tracker_accessed
                   ‚îÇ
                   ‚îú‚îÄ‚îÄ‚ñ∫ Toca "Clasificador" ‚Üí evento: expense_classifier_accessed
                   ‚îÇ
                   ‚îú‚îÄ‚îÄ‚ñ∫ Toca "Ofertas" ‚Üí evento: deal_hunter_accessed
                   ‚îÇ
                   ‚îú‚îÄ‚îÄ‚ñ∫ Toca "Asistente por Voz"
                   ‚îÇ    ‚îÇ
                   ‚îÇ    ‚îú‚îÄ‚îÄ‚ñ∫ Evento: voice_assistant_accessed
                   ‚îÇ    ‚îÇ
                   ‚îÇ    ‚îî‚îÄ‚îÄ‚ñ∫ Confirma gasto
                   ‚îÇ         ‚îÇ
                   ‚îÇ         ‚îî‚îÄ‚îÄ‚ñ∫ Evento: voice_expense_added (con datos)
                   ‚îÇ
                   ‚îî‚îÄ‚îÄ‚ñ∫ Toca "Gamificaci√≥n" ‚Üí evento: gamification_accessed
```

---

## üîß Configuraci√≥n del Workflow en n8n

### Estructura Recomendada

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Webhook    ‚îÇ (Recibe todos los eventos)
‚îÇ   (POST)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Switch Node  ‚îÇ (Filtra por "action")
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚ñ∫ subscription_tracker_accessed ‚Üí [L√≥gica de suscripciones]
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚ñ∫ expense_classifier_accessed ‚Üí [Activar clasificador]
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚ñ∫ deal_hunter_accessed ‚Üí [Buscar ofertas]
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚ñ∫ voice_assistant_accessed ‚Üí [Log de uso]
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚ñ∫ voice_expense_added ‚Üí [Guardar gasto + Actualizar presupuesto]
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚ñ∫ voice_input_cancelled ‚Üí [Analytics]
       ‚îÇ
       ‚îî‚îÄ‚îÄ‚ñ∫ gamification_accessed ‚Üí [Actualizar progreso]
```

### Nodos Sugeridos para cada Evento

#### Para `voice_expense_added` (El m√°s importante):

1. **Switch Node** - Filtra por action === "voice_expense_added"
2. **Set Node** - Extrae datos del gasto:
   ```
   amount: {{$json.body.data.amount}}
   merchant: {{$json.body.data.merchant}}
   category: {{$json.body.data.category}}
   userId: {{$json.body.userId}}
   ```
3. **PostgreSQL/MySQL** - Guarda en base de datos
4. **HTTP Request** - Actualiza presupuesto en API
5. **Send Email** - Confirmaci√≥n al usuario
6. **Respond to Webhook** - Respuesta exitosa

#### Para eventos de acceso (analytics):

1. **Switch Node** - Filtra por action
2. **Google Sheets** - Registra en hoja de analytics
3. **Respond to Webhook** - Respuesta simple

---

## üß™ Probar los Eventos

### Desde la App:

1. Compila e instala la app
2. Abre la app e inicia sesi√≥n
3. Ve a "Herramientas Financieras"
4. Toca cada funci√≥n para disparar los eventos
5. Ve a n8n ‚Üí Executions para ver los eventos

### Desde Scripts:

Puedes probar cada evento individualmente:

```bash
# Test: Suscripciones
curl -X POST https://userfox.app.n8n.cloud/webhook-test/finanzas-webhook \
  -H "Content-Type: application/json" \
  -d '{"action":"subscription_tracker_accessed","userId":"test","timestamp":"123","data":{"event_description":"Test"}}'

# Test: Gasto por voz
curl -X POST https://userfox.app.n8n.cloud/webhook-test/finanzas-webhook \
  -H "Content-Type: application/json" \
  -d '{"action":"voice_expense_added","userId":"test","timestamp":"123","data":{"amount":"50","merchant":"Tienda","category":"Comida","input_method":"voice"}}'
```

---

## üìä Datos que Recibir√°s en n8n

### Evento Simple (Ejemplo):
```json
{
  "headers": {...},
  "params": {},
  "query": {},
  "body": {
    "action": "subscription_tracker_accessed",
    "userId": "123",
    "timestamp": "1730000000000",
    "data": {
      "event_description": "Usuario accedi√≥ al rastreador de suscripciones",
      "timestamp": "1730000000000"
    }
  }
}
```

### Evento con Datos (Gasto por Voz):
```json
{
  "headers": {...},
  "params": {},
  "query": {},
  "body": {
    "action": "voice_expense_added",
    "userId": "123",
    "timestamp": "1730000000000",
    "data": {
      "amount": "150.50",
      "merchant": "Super Mercado",
      "category": "Alimentaci√≥n",
      "input_method": "voice"
    }
  }
}
```

---

## üí° Ideas de Automatizaciones en n8n

### 1. Notificaciones Inteligentes
- Cuando se agrega un gasto por voz > Q100, enviar email
- Cuando se accede a ofertas, buscar descuentos relevantes
- Cuando se completa un reto, enviar notificaci√≥n push

### 2. Analytics
- Guardar todos los eventos en Google Sheets
- Crear dashboard de uso de funciones
- Generar reportes semanales

### 3. Integraci√≥n con Otros Servicios
- Sincronizar gastos con Google Calendar
- Enviar datos a CRM
- Conectar con Notion para tracking
- Integrar con Slack para notificaciones del equipo

### 4. Machine Learning
- Analizar patrones de gasto
- Predecir gastos futuros
- Sugerir categor√≠as autom√°ticamente

---

## ‚úÖ Checklist de Implementaci√≥n

- [x] Integraci√≥n de eventos en FinancialToolsActivity
- [x] Webhook client configurado
- [x] URL correcta: finanzas-webhook
- [x] 7 eventos diferentes implementados
- [x] Manejo de errores
- [x] Logging para debugging
- [ ] Recompilar la app
- [ ] Probar todos los eventos
- [ ] Configurar workflow en n8n
- [ ] Verificar que llegan los datos

---

## üéâ Resultado Final

Ahora **cada acci√≥n del usuario** en Herramientas Financieras se registra en n8n, permiti√©ndote:

‚úÖ Rastrear el uso de cada funci√≥n  
‚úÖ Automatizar procesos basados en acciones del usuario  
‚úÖ Guardar gastos agregados por voz  
‚úÖ Generar analytics en tiempo real  
‚úÖ Crear flujos personalizados para cada evento  

**¬°Tu app est√° completamente integrada con n8n!** üöÄ

---

**√öltima actualizaci√≥n:** Octubre 2025  
**Archivo modificado:** `FinancialToolsActivity.java`  
**Eventos implementados:** 7

